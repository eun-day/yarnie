# 세션 관리 시스템 요구사항

## 소개

Yarnie 앱의 작업 세션 관리 시스템은 사용자가 프로젝트별로 시간을 추적하고 관리할 수 있도록 하는 핵심 기능입니다. 이 시스템은 시작, 일시정지, 재개, 중지의 라이프사이클을 통해 정확한 시간 추적과 세션 상태 관리를 제공합니다.

## 요구사항

### 요구사항 1: 세션 시작 관리

**사용자 스토리:** 사용자로서 프로젝트 작업을 시작할 때 새로운 세션을 생성하거나 기존 세션을 이어서 할 수 있기를 원한다.

#### 승인 기준

1. WHEN 사용자가 시작 버튼을 누르고 활성 세션이 없을 때 THEN 시스템은 새로운 세션을 running 상태로 생성해야 한다
2. WHEN 사용자가 시작 버튼을 누르고 paused 상태의 활성 세션이 있을 때 THEN 시스템은 사용자에게 이어하기/새로 시작 선택지를 제공해야 한다
3. WHEN 사용자가 이어하기를 선택할 때 THEN 시스템은 기존 세션을 running 상태로 변경해야 한다
4. WHEN 사용자가 새로 시작을 선택할 때 THEN 시스템은 기존 세션을 stopped 상태로 변경하고 새 세션을 running 상태로 생성해야 한다
5. WHEN 세션이 running 상태로 시작될 때 THEN 시스템은 lastStartedAt을 현재 시각으로 설정해야 한다

### 요구사항 2: 세션 일시정지 관리

**사용자 스토리:** 사용자로서 작업을 잠시 중단할 때 현재까지의 진행 시간을 보존하면서 세션을 일시정지할 수 있기를 원한다.

#### 승인 기준

1. WHEN 사용자가 일시정지 버튼을 누르고 세션이 running 상태일 때 THEN 시스템은 세션을 paused 상태로 변경해야 한다
2. WHEN 세션이 paused 상태로 변경될 때 THEN 시스템은 현재까지의 경과 시간을 elapsedMs에 누적해야 한다
3. WHEN 세션이 paused 상태로 변경될 때 THEN 시스템은 lastStartedAt을 null로 설정해야 한다
4. WHEN 세션이 paused 상태일 때 THEN 시스템은 시간 누적을 중단해야 한다

### 요구사항 3: 세션 재개 관리

**사용자 스토리:** 사용자로서 일시정지된 세션을 다시 시작하여 작업을 계속할 수 있기를 원한다.

#### 승인 기준

1. WHEN 사용자가 시작 버튼을 누르고 세션이 paused 상태일 때 THEN 시스템은 세션을 running 상태로 변경해야 한다
2. WHEN 세션이 running 상태로 재개될 때 THEN 시스템은 lastStartedAt을 현재 시각으로 설정해야 한다
3. WHEN 세션이 재개될 때 THEN 시스템은 기존 elapsedMs 값을 유지해야 한다
4. WHEN 세션이 재개될 때 THEN 시스템은 시간 누적을 다시 시작해야 한다

### 요구사항 4: 세션 중지 및 완료 관리

**사용자 스토리:** 사용자로서 작업을 완료했을 때 세션을 종료하고 라벨과 메모를 추가할 수 있기를 원한다.

#### 승인 기준

1. WHEN 사용자가 랩 버튼을 누를 때 THEN 시스템은 현재 세션을 일시정지하고 세션 종료 다이얼로그를 표시해야 한다
2. WHEN 사용자가 세션 종료를 확인할 때 THEN 시스템은 세션을 stopped 상태로 변경해야 한다
3. WHEN 세션이 stopped 상태로 변경될 때 AND 세션이 running 상태였다면 THEN 시스템은 최종 경과 시간을 elapsedMs에 누적해야 한다
4. WHEN 세션이 stopped 상태로 변경될 때 THEN 시스템은 stoppedAt을 현재 시각으로 설정해야 한다
5. WHEN 사용자가 라벨과 메모를 입력할 때 THEN 시스템은 해당 정보를 세션에 저장해야 한다

### 요구사항 5: 세션 상태 불변 조건 관리

**사용자 스토리:** 시스템 관리자로서 데이터 무결성을 보장하기 위해 세션 상태 규칙이 항상 유지되기를 원한다.

#### 승인 기준

1. WHEN 시스템이 세션을 관리할 때 THEN 각 프로젝트는 최대 1개의 활성 세션(running 또는 paused)만 가져야 한다
2. WHEN 새 세션을 시작할 때 AND 활성 세션이 이미 존재한다면 THEN 시스템은 예외를 발생시키거나 사용자 선택을 요구해야 한다
3. WHEN 세션이 running 상태일 때 THEN lastStartedAt 필드는 null이 아니어야 한다
4. WHEN 세션이 paused 또는 stopped 상태일 때 THEN lastStartedAt 필드는 null이어야 한다
5. WHEN 총 누적 시간을 계산할 때 THEN stopped 상태의 세션과 현재 활성 세션(running/paused)의 경과 시간을 모두 합산해야 한다

### 요구사항 6: 활성 세션 초기화 관리

**사용자 스토리:** 사용자로서 잘못 시작한 활성 세션을 취소하고 이전 상태로 되돌릴 수 있기를 원한다.

#### 승인 기준

1. WHEN 사용자가 초기화 버튼을 누를 때 THEN 시스템은 현재 활성 세션(running 또는 paused)을 삭제해야 한다
2. WHEN 활성 세션이 초기화될 때 THEN 시스템은 UI의 경과 시간을 완료된 세션들의 누적 시간으로 복원해야 한다
3. WHEN 활성 세션이 초기화될 때 THEN 시스템은 DB에서 총 누적 시간을 다시 계산하여 UI에 반영해야 한다

### 요구사항 7: 실시간 시간 추적 관리

**사용자 스토리:** 사용자로서 현재 작업 중인 시간이 실시간으로 업데이트되는 것을 볼 수 있기를 원한다.

#### 승인 기준

1. WHEN 세션이 running 상태일 때 THEN 시스템은 50ms마다 UI의 경과 시간을 업데이트해야 한다
2. WHEN 세션이 paused 또는 stopped 상태일 때 THEN 시스템은 시간 업데이트를 중단해야 한다
3. WHEN 앱이 백그라운드에서 포그라운드로 돌아올 때 THEN 시스템은 정확한 경과 시간을 계산하여 표시해야 한다
4. WHEN 시간을 표시할 때 THEN 시스템은 hh:mm:ss 형식으로 표시해야 한다